function initialize(o){geocoder=new google.maps.Geocoder;var e={zoom:14,center:new google.maps.LatLng(o.coords.latitude,o.coords.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),e);var a=new google.maps.Marker({position:new google.maps.LatLng(o.coords.latitude,o.coords.longitude),title:"You are here!",icon:"http://maps.google.com/mapfiles/ms/icons/orange.png",map:map});markers.push(a),addPlacesOnMap()}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(initialize):x.innerHTML="Geolocation is not supported by this browser."}function addPlacesOnMap(){var o=new google.maps.InfoWindow({content:""});$.ajax({url:"/data/places",dataType:"json",success:function(e){if("OK"==e.status){places=e.places;for(p in places){latLng_place=new google.maps.LatLng(places[p].geo[0],places[p].geo[1]);var a=new google.maps.Marker({map:map,position:latLng_place,title:places[p].geo_name,icon:"http://maps.google.com/mapfiles/ms/icons/green.png"});bindInfoWindow(a,map,o,"<b>"+places[p].description+"</b><br>"+places[p].geo_name),markers.push(a)}}}})}function bindInfoWindow(o,e,a,n){google.maps.event.addListener(o,"click",function(){a.setContent(n),a.open(e,o)})}var geocoder,map,places,markers=[];google.maps.event.addDomListener(window,"load",getLocation);